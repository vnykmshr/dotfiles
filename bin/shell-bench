#!/usr/bin/env bash
# Simple shell startup benchmark

runs=${1:-5}
echo "Benchmarking zsh startup ($runs runs)..."

total=0
for i in $(seq 1 "$runs"); do
    start=$(date +%s.%N)
    zsh -i -c exit >/dev/null 2>&1
    end=$(date +%s.%N)
    duration=$(echo "$end - $start" | bc 2>/dev/null || python3 -c "print($end - $start)")
    total=$(echo "$total + $duration" | bc 2>/dev/null || python3 -c "print($total + $duration)")
    printf "Run %d: %.3fs\n" "$i" "$duration"
done

average=$(echo "scale=3; $total / $runs" | bc 2>/dev/null || python3 -c "print(round($total / $runs, 3))")
printf "Average: %.3fs\n" "$average"

# Performance rating
if (($(echo "$average < 0.2" | bc -l 2>/dev/null || python3 -c "print($average < 0.2)"))); then
    echo "Rating: Excellent"
elif (($(echo "$average < 0.5" | bc -l 2>/dev/null || python3 -c "print($average < 0.5)"))); then
    echo "Rating: Good"
else
    echo "Rating: Needs optimization"
fi
