# Alias reminder system - shows helpful aliases periodically

# Configuration
ALIAS_REMINDER_ENABLED="${ALIAS_REMINDER_ENABLED:-true}"
ALIAS_REMINDER_FREQUENCY="${ALIAS_REMINDER_FREQUENCY:-10}"
ALIAS_REMINDER_LEVEL="${ALIAS_REMINDER_LEVEL:-beginner}"
ALIAS_REMINDER_MAX_TIPS="${ALIAS_REMINDER_MAX_TIPS:-3}"
ALIAS_REMINDER_DIR="$HOME/.config/dotfiles"
ALIAS_REMINDER_COUNTER="$ALIAS_REMINDER_DIR/session-counter"

# Create directory if needed
[[ ! -d "$ALIAS_REMINDER_DIR" ]] && mkdir -p "$ALIAS_REMINDER_DIR"

# Curated aliases based on usage patterns
declare -A ALIASES
ALIASES=(
    # Beginner (most frequent commands)
    "md"    "make dev (you use this 128 times!)"
    "acp"   "git add -u && git commit && git push"
    "gst"   "git status --short --branch (you use this 558 times!)"
    "ws"    "cd $HOME/workspace"
    "proj"  "cd $HOME/workspace/projects"
    "ll"    "ls -la"
    "reload" "source ~/.zshrc"

    # Intermediate
    "gup"   "git pull && git submodule update"
    "gcl"   "git clean -fd && git reset --hard"
    "dev"   "smart project dev server"
    "cpu"   "htop --sort-key PERCENT_CPU"
    "ports" "show open network ports"
    "cls"   "clear screen"
    "path"  "show PATH in readable format"

    # Advanced
    "workflow" "complete development automation"
    "qc"    "quick commit with auto messages"
    "status" "enhanced project status"
)

increment_session_counter() {
    local count=0
    [[ -f "$ALIAS_REMINDER_COUNTER" ]] && count=$(cat "$ALIAS_REMINDER_COUNTER")
    echo $((count + 1)) > "$ALIAS_REMINDER_COUNTER"
    echo $((count + 1))
}

should_show_reminder() {
    local session_count=$(increment_session_counter)
    (( session_count % ALIAS_REMINDER_FREQUENCY == 0 ))
}

show_reminders() {
    # Get random aliases
    local -a keys=(${(k)ALIASES})
    local -a selected=()
    local count=0

    # Simple random selection
    for key in ${(o)keys}; do
        [[ $count -lt $ALIAS_REMINDER_MAX_TIPS ]] || break
        selected+="$key"
        ((count++))
    done

    [[ ${#selected[@]} -eq 0 ]] && return

    echo "\n💡 Alias Reminders (Level: $ALIAS_REMINDER_LEVEL)"
    echo "════════════════════════════════════════"

    for alias in $selected; do
        printf "%-12s %s\n" "$alias" "${ALIASES[$alias]}"
    done

    echo "\n💡 Try these shortcuts to speed up your workflow!"
    echo "   Configure: export ALIAS_REMINDER_LEVEL={beginner|intermediate|advanced}"
    echo "   Disable:   export ALIAS_REMINDER_ENABLED=false\n"
}

# Management commands
alias-reminder-level() {
    case "$1" in
        beginner|intermediate|advanced)
            export ALIAS_REMINDER_LEVEL="$1"
            echo "Alias reminder level set to: $1"
            ;;
        *)
            echo "Usage: alias-reminder-level {beginner|intermediate|advanced}"
            echo "Current level: $ALIAS_REMINDER_LEVEL"
            ;;
    esac
}

alias-reminder-show() { show_reminders; }
alias-reminder-disable() { export ALIAS_REMINDER_ENABLED=false; echo "Disabled"; }
alias-reminder-enable() { export ALIAS_REMINDER_ENABLED=true; echo "Enabled"; }
alias-reminder-reset() { rm -f "$ALIAS_REMINDER_COUNTER"; echo "Reset"; }

# Short aliases
alias ar-level='alias-reminder-level'
alias ar-show='alias-reminder-show'
alias ar-on='alias-reminder-enable'
alias ar-off='alias-reminder-disable'

# Auto-run in interactive shells
if [[ $- == *i* && "$ALIAS_REMINDER_ENABLED" == "true" ]]; then
    should_show_reminder && show_reminders
fi
