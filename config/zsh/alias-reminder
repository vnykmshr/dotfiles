# Alias reminder system - shows helpful aliases periodically

# Configuration
ALIAS_REMINDER_ENABLED="${ALIAS_REMINDER_ENABLED:-true}"
ALIAS_REMINDER_FREQUENCY="${ALIAS_REMINDER_FREQUENCY:-10}"
ALIAS_REMINDER_LEVEL="${ALIAS_REMINDER_LEVEL:-beginner}"
ALIAS_REMINDER_MAX_TIPS="${ALIAS_REMINDER_MAX_TIPS:-3}"
ALIAS_REMINDER_DIR="$HOME/.config/dotfiles"
ALIAS_REMINDER_COUNTER="$ALIAS_REMINDER_DIR/session-counter"

# Create directory if needed
[[ ! -d "$ALIAS_REMINDER_DIR" ]] && mkdir -p "$ALIAS_REMINDER_DIR"

# Curated aliases based on usage patterns
declare -A ALIASES
ALIASES=(
    # Navigation & File Management
    ".."    "cd .. (go up one directory)"
    "..."   "cd ../.."
    "ws"    "cd $HOME/workspace"
    "proj"  "cd $HOME/workspace/projects"
    "ll"    "ls -la with details"
    "la"    "ls -la all files"
    "lt"    "tree view (level 2)"
    "lm"    "ls with pager"
    "ducks" "show largest directories"
    "findbig" "find 5 largest files"

    # Git Shortcuts
    "gst"   "git status (you use this often!)"
    "ga"    "git add"
    "gc"    "git commit"
    "gp"    "git push"
    "gd"    "git diff"
    "gup"   "git pull && submodule update"
    "gcl"   "git clean -fd && reset --hard"
    "mygh"  "enhanced git helpers"
    "gsave" "git save helper"

    # System Monitoring
    "cpu"   "htop sorted by CPU usage"
    "ports" "show open network ports"
    "conncount" "count network connections by state"
    "wotgobblemem" "top 15 memory-consuming processes"
    "memfree" "show free memory"
    "dskload" "show disk I/O processes"
    "psg"   "ps aux | grep"

    # Development Tools
    "serve" "python3 -m http.server"
    "cls"   "clear screen"
    "path"  "show PATH in readable format"
    "curly" "enhanced curl with timing details"
    "vgrep" "smart grep with fd + ripgrep"
    "v"     "open in $EDITOR"

    # Network & Web
    "get"   "curl with progress bar"
    "header" "curl headers only"
    "ping"  "ping with 5 packets"
    "fastping" "ping 100 packets"

    # Safety & Utilities
    "rm"    "rm -i (interactive deletion)"
    "cp"    "cp -i (interactive copy)"
    "mv"    "mv -i (interactive move)"
    "df"    "df -h (human readable)"
    "du"    "du -h (human readable)"
    "reload" "source ~/.zshrc"

    # Typo Protection
    "shh"   "ssh (common typo fix)"
    "sduo"  "sudo (typo fix)"
    "suod"  "sudo (typo fix)"
)

increment_session_counter() {
    local count=0
    [[ -f "$ALIAS_REMINDER_COUNTER" ]] && count=$(cat "$ALIAS_REMINDER_COUNTER")
    echo $((count + 1)) > "$ALIAS_REMINDER_COUNTER"
    echo $((count + 1))
}

should_show_reminder() {
    local session_count=$(increment_session_counter)
    (( session_count % ALIAS_REMINDER_FREQUENCY == 0 ))
}

show_reminders() {
    # Get all available aliases
    local -a keys=(${(k)ALIASES})
    local -a selected=()
    local total_keys=${#keys[@]}

    # Return if no aliases
    [[ $total_keys -eq 0 ]] && return

    # Randomly select aliases
    local count=0
    local max_attempts=$((ALIAS_REMINDER_MAX_TIPS * 3))  # Prevent infinite loops
    local attempts=0

    while [[ $count -lt $ALIAS_REMINDER_MAX_TIPS && $attempts -lt $max_attempts ]]; do
        local random_index=$(( (RANDOM % total_keys) + 1 ))
        local selected_key="${keys[$random_index]}"

        # Check if already selected
        if [[ ! " ${selected[@]} " =~ " ${selected_key} " ]]; then
            selected+=("$selected_key")
            ((count++))
        fi
        ((attempts++))
    done

    [[ ${#selected[@]} -eq 0 ]] && return

    echo "\n💡 Alias Reminders (${#selected[@]} random tips)"
    echo "════════════════════════════════════════"

    for alias in $selected; do
        printf "%-15s %s\n" "$alias" "${ALIASES[$alias]}"
    done

    echo "\n💡 Try these shortcuts to speed up your workflow!"
    echo "   Show more: ar-show  |  Level: ar-level {beginner|intermediate|advanced}"
    echo "   Disable:   ar-off   |  Enable: ar-on\n"
}

# Management commands
alias-reminder-level() {
    case "$1" in
        beginner|intermediate|advanced)
            export ALIAS_REMINDER_LEVEL="$1"
            echo "Alias reminder level set to: $1"
            ;;
        *)
            echo "Usage: alias-reminder-level {beginner|intermediate|advanced}"
            echo "Current level: $ALIAS_REMINDER_LEVEL"
            ;;
    esac
}

alias-reminder-show() { show_reminders; }
alias-reminder-disable() { export ALIAS_REMINDER_ENABLED=false; echo "Disabled"; }
alias-reminder-enable() { export ALIAS_REMINDER_ENABLED=true; echo "Enabled"; }
alias-reminder-reset() { rm -f "$ALIAS_REMINDER_COUNTER"; echo "Reset"; }

# Short aliases
alias ar-level='alias-reminder-level'
alias ar-show='alias-reminder-show'
alias ar-on='alias-reminder-enable'
alias ar-off='alias-reminder-disable'

# Auto-run in interactive shells
if [[ $- == *i* && "$ALIAS_REMINDER_ENABLED" == "true" ]]; then
    should_show_reminder && show_reminders
fi
